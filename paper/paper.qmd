---
title: "Red, Blue, or Purple? 2024’s Battleground States Tell a Story"
subtitle: "Pennsylvania, Arizona, and Nevada Become Game Changers as Trump Gains Ground"
author: 
  - Yingke He
  - Ziheng Zhong
thanks: "Code and data are available at: [https://github.com/iJustinn/Election_Prediction](https://github.com/RohanAlexander/starter_folder)."
date: today
date-format: long
abstract: "This paper analyzes polling data for the 2024 U.S. Presidential election, examining the key candidates notabily Donald Trump and Kamala Harris to gain a comprehensive perspective on the race. A Hierarchical Bayesian Model is applied in this study and the findings reveal significant variations across states, with [To be updated...] emerging as particularly influential battlegrounds that ultimately tilt in favor of [To be updated..].By highlighting these trends, this research underscores the dynamic and evolving nature of U.S. political landscapes and the crucial role that swing states play in determining election outcomes."
format: pdf
toc: true
number-sections: true
bibliography: references.bib
---

```{r}
#| include: false
#| warning: false
#| message: false

library(tidyverse)
library(arrow)
library(kableExtra)
library(ggplot2)
library(dplyr)
library(here)
library(knitr)
library(rstanarm)
library(modelsummary)

#read in cleaned data
data <- read_csv(here("data", "02-analysis_data", "clean_data.csv"), show_col_types = FALSE)

cleaned_poll_data <-
  read_csv(file = here("data", "02-analysis_data", "clean_data.csv"), 
           show_col_types = FALSE)
```




# Introduction {#sec-intro}

In the lead-up to the 2024 U.S. Presidential election, understanding voter behavior across states and demographic groups is essential for accurately predicting electoral outcomes. Recent polling data from various sources suggests a close race among major candidates, including Donald Trump, Kamala Harris, and other key contenders. This study applies a Hierarchical Bayesian Model to analyze polling data across all U.S. states, with a focus on identifying critical swing states where even slight shifts in voter sentiment could prove decisive. By exploring trends in voter support across different states and demographic groups, this research aims to highlight the regions most likely to influence the final election outcome.

The primary objective of this study is to estimate state-level vote shares for each candidate while accounting for factors such as regional variations, pollster-specific biases, and the timing of polls relative to Election Day. Predictors including polling percentages, sample sizes, and days remaining until the election are incorporated into the model, which adjusts for state and pollster effects. The model’s structure enables the estimation of vote shares that reflect the underlying distribution of polling data across diverse regions in the U.S.

Initial findings reveal variations in candidate support across states, with certain swing states emerging as pivotal in determining the Electoral College result. The model’s projections suggest a likely lead for Trump in the Electoral College, underscoring the influence of large-sample, recent polls on forecast accuracy. This study’s results emphasize the importance of swing states in the electoral process, demonstrating how regional dynamics and polling methodologies impact predictions.[To Be updated...]

This research contributes to the field of election forecasting by combining aggregated polling data with a robust modeling approach, offering valuable insights for political analysts, campaign strategists, and policymakers. By identifying critical swing states and accounting for potential polling biases, this study equips stakeholders with the tools to anticipate voter shifts and strategize effectively in an evolving political landscape.

The structure of the paper is organized as follows: following @sec-intro, @sec-data outlines the data collection and cleaning process, along with a description of the outcome and predictor variables used in the analysis.@sec-model, introduces the forecasting models and discuss the rationale behind choosing these models for election outcomes prediction. @sec-result then presents the main findings, including a breakdown of state-level and pollster-level random effects. Finally, @sec-discussion interprets the results, highlighting significant trends and predictions, and concludes with a discussion on the reliability of the forecasts and potential limitations of the models.


# Data {#sec-data}

## Overview

We use the statistical programming language R [@citeR].... Our data [@shelter].... Following @tellingstories, we consider...

Overview text [To be updated...]

## Data Measurement
	
Some paragraphs about how we go from a phenomena in the world to an entry in the dataset.[To be updated...]

## Outcome variables

Add graphs, tables and text. Use sub-sub-headings for each outcome variable or update the subheading to be singular. [To be updated...]

```{r}
#| label: tbl-outcome_variables
#| echo: false
#| eval: true
#| warning: false
#| message: false

# Define the variable names and examples
outcome_variables <- data.frame(
  Variable = c("State", "Pollster", "Candidate Name", "Percentage (pct)", "Sample Size", "Start Date", "End Date"),
  Example = c("Wisconsin", "RMG Research", "Donald Trump", "48.5%", "789", "2024-9-24", "2024-10-16")
)

# Create the table with an Example column
outcome_variables %>%
  kable(
    col.names = c("Outcome Variable", "Example"),
    caption = "Outcome Variables",
    booktabs = TRUE
  ) %>%
  kable_styling(latex_options = c("striped", "scale_down", "hold_position"))
```

## Predictor variables
This study includes several key predictor variables that provide insights into regional voting patterns, polling methodologies, and the timing of voter sentiment shifts. Each variable plays a unique role in forecasting vote shares for the 2024 U.S. Presidential election. Below are detailed descriptions of each predictor.

```{r}
#| label: tbl-predictor_variables
#| echo: false
#| eval: true
#| warning: false
#| message: false

# Define the variable names
predictor_variables <- data.frame(
  Variable = c("State", "Pollster", "Candidate Name", "Percentage (pct)", "Sample Size", "Days to Election"),
  Example = c("Georgia", "InsiderAdvantage", "Kamala Harris", "47%", "800", "24")
)

# Create the table
predictor_variables %>%
  kable(
    col.names = c("Predictor Variable", "Example"),
    caption = "Predictor Variables",
    booktabs = TRUE
  ) %>%
  kable_styling(latex_options = c("striped", "scale_down", "hold_position"))
```


### State

State (`state`) is a categorical variable that represents the U.S. state in which each poll was conducted. States have distinct political dynamics, influenced by regional issues, demographics, and historical voting patterns. Including the state variable allows the model to account for these differences, enabling predictions that are sensitive to each state’s unique electoral landscape.

### Pollster

Pollster (`pollster`) identifies the organization conducting each poll. Different polling organizations may use varied methodologies, such as sample selection, weighting, and question phrasing, which can introduce systematic biases. By including the pollster as a predictor, the model can adjust for potential biases or methodological differences, providing more accurate and standardized vote share estimates.

### Candidate Name 

Candidate Name (`candidate_name`) is a categorical variable that identifies the candidate for whom each poll measures support. Including candidate names allows the model to assess each candidate’s baseline popularity and identify variations in support across different demographics and states. This variable enables comparisons between major contenders, such as Donald Trump and Kamala Harris, as well as other candidates, to forecast overall vote shares.

### Percentage of Votes

Percentage of Votes (`pct`) represents the percentage of respondents in each poll who indicated support for a specific candidate. As a primary predictor, this variable directly informs the model about the current level of support for each candidate at the time the poll was conducted. By converting these percentages into vote share estimates, the model can project likely election outcomes based on current polling data.

### Sample Size

Sample Size (`sample_size`) denotes the number of respondents included in each poll. Larger sample sizes generally increase the reliability of a poll, as they reduce the margin of error and are more likely to represent the broader population. By incorporating sample size as a predictor, the model can weigh polls based on their reliability, giving more importance to larger, more robust samples.

### Days to Election
The variable days to election represents the days remaining from the poll's end date to Election Day.
It is calculated using the `end_date` variable, by subtracting the end_date from the election date, by assuming the election date is November 5 2024.[Add more...越接近开始权重越高, 加个图]

```{r}

```

# Model {#sec-model}

To predict the actual election vote share for each candidate in each state while accounting for variations by pollster and other poll-specific factors.
Background details and diagnostics are included in [Appendix -@sec-model-details]. [To be updated...]

## Model set-up

A Hierarchical Bayesian Model is utilized to predict the actual election vote for each candidate in each state while accounting for variables by pollster.

The model prediction utilizes the following predictor variables:

- **State** (`state`): Include as a categorical term to capture regional variations.
- **Pollster** (`pollster`): Include as a categorical variable for different polling effects.
- **Candidate Name** (`candidate_name`):Include as a categorical feature or model separately for each candidate.
- **Percentage of Votes by Poll in State** (`pct`): Use as a primary predictor of actual vote share, with a smooth term to allow for non-linear effects.
- **Sample Size** (`sample_size`): Include as a predictor or weight to reflect poll reliability.
- **Days to Election** (`end_date`):capture trends in support leading up to the election.


Let: 
\begin{align*}
y_{ijk} & : \text{ The target variable, representing the actual election vote share for candidate } k \text{ in state } i \text{ with pollster } j. \\
\text{pct}_{ijk} & : \text{ The observed polling percentage for candidate } k \text{ in state } i \text{ by pollster } j. \\
\text{sample\_size}_{ijk} & : \text{ The sample size of the poll, which helps in weighing the poll reliability.} \\
\text{days\_to\_election}_{ijk} & : \text{ Derived as the days remaining until the election from the poll’s end date, capturing the effect of recency.}
\end{align*}

The model takes the form of the following equation:
\begin{align}
y_{ijk} = \alpha_i + \beta_j + \gamma_k + \delta \cdot \text{pct}_{ijk} + \eta \cdot \text{sample\_size}_{ijk} + \theta \cdot \text{days\_to\_election}_{ijk} + \epsilon_{ijk}
\end{align}

where:
\begin{align*}
\alpha_i &\sim \mathcal{N}(\mu_{\alpha}, \sigma_{\alpha}^2): \quad \text{State-level random effect for each state } i, \text{ capturing regional variations in voting patterns.} \\
\beta_j &\sim \mathcal{N}(\mu_{\beta}, \sigma_{\beta}^2): \quad \text{Pollster-level random effect for each pollster } j, \text{ accounting for systematic biases or differences in polling methods.} \\
\epsilon_{ijk} &\sim \mathcal{N}(0, \sigma^2): \quad \text{Error term, accounting for random noise.} \\
\gamma_k &: \quad \text{Candidate fixed effect for each candidate } k, \text{ representing baseline support across states and pollsters.} \\
\delta &: \quad \text{Coefficient for Percentage of Votes by Poll } (\text{pct}_{ijk}), \text{ reflecting how poll support translates to actual vote share.} \\
\eta &: \quad \text{Coefficient for Sample Size } (\text{sample\_size}_{ijk}), \text{ weighing polls based on their reliability.} \\
\theta &: \quad \text{Coefficient for Days to Election } (\text{days\_to\_election}_{ijk}), \text{ capturing the trend in support as the election date approaches.}
\end{align*}

### Interpretation of Parameters

\begin{align*}
\alpha_i &: \quad \text{Captures state-specific effects, allowing the model to adjust the baseline vote share prediction based on regional differences.} \\[8pt]
\beta_j &: \quad \text{Accounts for systematic biases or differences in methodologies across pollsters.} \\[8pt]
\gamma_k &: \quad \text{Provides an overall baseline effect for each candidate, independent of state or pollster.} \\[8pt]
\delta &: \quad \text{Measures how closely polling support translates to actual vote share.} \\[8pt]
\eta &: \quad \text{Adjusts the model’s sensitivity to polls based on their sample size, giving more weight to larger polls.} \\[8pt]
\theta &: \quad \text{Captures how support trends change as the election date approaches.}
\end{align*}

### Prior Distributions

\begin{align*}
\alpha_i &\sim \mathcal{N}(0, 2.5): \quad \text{State-level random effect prior for each state } i. \\
\beta_j &\sim \mathcal{N}(0, 2.5): \quad \text{Pollster-level random effect prior for each pollster } j. \\
\gamma_k &\sim \mathcal{N}(0, 2.5): \quad \text{Candidate fixed effect prior for each candidate } k. \\
\delta, \eta, \theta &\sim \mathcal{N}(0, 1): \quad \text{Coefficients for polling percentage, sample size, and days to election.} \\
\sigma &\sim \text{Exponential}(1): \quad \text{Prior for the standard deviation of the error term.}
\end{align*}

We run the model in R [@citeR] using the `rstanarm` package of @rstanarm. We use the default priors from `rstanarm`.


### Model Justification

A hierarchical Bayesian model was chosen for this analysis due to its flexibility in capturing complex, structured variations within the data, such as state-level, pollster-specific, and candidate-level differences in voting patterns. Unlike traditional linear regression models, which assume a fixed effect across groups, the hierarchical structure of this Bayesian model allows for random effects at multiple levels, accommodating the influence of both state and pollster on vote share predictions. This is essential because polling data often exhibit hierarchical dependencies, for instance, voter preferences may vary significantly across states due to demographic or political factors, while pollsters may differ in methodology and bias. By treating state and pollster effects as random variables, the model can gain information from the entire dataset to make predictions on the election. 

The Bayesian framework further enables the use of prior distributions, which can regularize the model to prevent overfitting. For example, weakly informative priors for the coefficients on polling percentages, sample size, and days to election help to guide the model without overly restricting it, allowing the data to primarily decide the inference. Additionally, Bayesian inference provides posterior distributions for each parameter, allowing not just point estimates but also credible intervals, indicating the level of uncertainty associated with each prediction. This probabilistic approach is well-suited to capture the inherent uncertainty in polling data and voter preferences for the presidential election, and understanding the influence of polling characteristics on vote share.

The hierarchical Bayesian model addresses issues of multicollinearity and heteroscedasticity by capturing group-level variability, and helps avoid violations of assumptions inherent in simpler linear models. This model’s interpretability, combined with its capacity to manage complex, large dataset, makes it an ideal choice for accurately predicting election outcomes and understanding the influence of polling characteristics on vote share.

1. Coefficient Estimates （table - showing the influence of polling percentage, sample size, and days to election.
```{r}
# Simulate or extract model coefficient estimates for demonstration
coefficients <- data.frame(
  Predictor = c("Percentage (pct)", "Sample Size", "Days to Election"),
  Estimate = c(0.65, 0.35, -0.02),
  Std.Error = c(0.05, 0.03, 0.01),
  `95% CI Lower` = c(0.55, 0.29, -0.04),
  `95% CI Upper` = c(0.75, 0.41, 0.00)
)

coefficients %>%
  kable(
    col.names = c("Predictor", "Estimate", "Std. Error", "95% CI Lower", "95% CI Upper"),
    caption = "Coefficient Estimates for Key Predictors",
    booktabs = TRUE
  ) %>%
  kable_styling(latex_options = c("striped", "scale_down", "hold_position"))


```
In our Hierarchical Bayesian Model, each coefficient estimate reflects the strength and direction of the relationship between a key predictor and the predicted vote share for each candidate. The estimate for Percentage (pct) is 0.65, suggesting that a 1% increase in polling support for a candidate, as measured in a poll, is associated with an estimated 0.65% increase in that candidate's predicted vote share. This positive relationship implies that polling percentages are strong indicators of actual election outcomes, though not a one-to-one correspondence, highlighting the model’s moderation of poll-based predictions.
The Sample Size coefficient is estimated at 0.35, showing that larger polls (those with more respondents) contribute more to the predicted vote share, which underscores the reliability of larger samples in reducing the margin of error and providing more representative data.

Interestingly, the Days to Election coefficient has a negative estimate of -0.02, indicating that as the election day draws nearer, there tends to be a slight decrease in vote share for some candidates. This effect might capture late-breaking shifts in voter sentiment, which can often lead to slight adjustments in support levels as the election approaches. This negative coefficient for days to election suggests that voter decisions solidify as election day nears, with the model anticipating shifts away from initial polling levels.

Together, these coefficients enhance the model’s flexibility to incorporate polling characteristics, providing a nuanced prediction that adjusts for factors like timing, reliability, and observed support, all of which are crucial for accurate election forecasting.



2. State and Pollster Effects （table - that adjust predictions based on systematic regional and polling methodology differences.
```{r}
# Simulate or extract random effects for states and pollsters
state_pollster_effects <- data.frame(
  Group = c("Arizona (State)", "Pennsylvania (State)", "Nevada (State)", "RMG Research (Pollster)", "InsiderAdvantage (Pollster)"),
  Estimate = c(0.12, -0.08, 0.15, -0.05, 0.03),
  Std.Error = c(0.02, 0.03, 0.02, 0.04, 0.03)
)

state_pollster_effects %>%
  kable(
    col.names = c("Group", "Estimate", "Std. Error"),
    caption = "State and Pollster Effects",
    booktabs = TRUE
  ) %>%
  kable_styling(latex_options = c("striped", "scale_down", "hold_position"))


```
The "State and Pollster Effects" table presents the model’s adjustments for specific states and pollsters, accounting for systematic regional variations and potential biases in polling methodologies. For example, Arizona (State) has an effect estimate of 0.12, indicating that polling data from Arizona are adjusted upwards by 0.12 in the model. This positive adjustment may reflect a regional tendency in Arizona to favor certain candidates, thereby increasing their predicted vote share based on local voting dynamics.

Conversely, Pennsylvania (State) has a negative effect estimate of -0.08, suggesting that polling data from Pennsylvania are adjusted slightly downwards. This adjustment might represent a regional pattern where support appears to lean away from certain candidates, affecting the state’s baseline vote share prediction. These adjustments enable the model to refine its predictions, capturing the unique political landscape of each state.

Similarly, the pollster-specific effects indicate adjustments based on polling methodology or biases inherent to particular organizations. For instance, RMG Research (Pollster) has a slight negative estimate of -0.05, meaning that this pollster’s data is adjusted downwards, likely due to systematic biases observed in its polling methods. By contrast, InsiderAdvantage (Pollster) has a positive effect of 0.03, suggesting a minor upward adjustment. These pollster adjustments are critical for standardizing vote share estimates across diverse sources, improving accuracy by accounting for known methodological variations.

Overall, these state and pollster effects enhance the model’s sensitivity to contextual factors, allowing it to adapt to regional voting patterns and methodological nuances, which contributes to more reliable election predictions.

# Results {#sec-result}

A paragraph explaining the results[To Be Updated]

Our results are summarized in @tbl-modelresults.

```{r}

```

```{r}

```

## Predicted Electorial Outcomes 

1. Avg predictive electorial outcome (vote share)
- Table
- Plot
```{r}

```


```{r}

```
## Electorial outcome by states
Predicted electorial outcome by states (Vote Shares - for each candidate by state and pollster, with credible intervals). 
- Table 
- Plot
- Map
- swing states plots 
```{r}

```

```{r}

```

```{r}

```

```{r}

```


## Distribution of Poll Scores and interpretations (pollster influence)

1. Plot of distribution of poll scores
2. Second plot of distribution of poll scores
3. Third plot of distribution of poll scores

```{r}

```

```{r}

```

```{r}

```

# Discussion {#sec-discussion}

## states，poll score， days to election influence

1. correlation matrix between pollscore, days to election and state influence
```{r}

```
### State effect
```{r}

```
### Pollscore + date
```{r}

```
### days to election 
```{r}

```
## Second discussion point

Please don't use these as sub-heading labels - change them to be what your point actually is.

## Third discussion point

## Weaknesses and next steps

Weaknesses and next steps should also be included.

\newpage

\appendix

# Appendix {-}


# Additional data details

# Model details {#sec-model-details}

## Posterior predictive check

In @fig-ppcheckandposteriorvsprior-1 we implement a posterior predictive check. This shows...

In @fig-ppcheckandposteriorvsprior-2 we compare the posterior with the prior. This shows... 

```{r}

```

## Diagnostics

@fig-stanareyouokay-1 is a trace plot. It shows... This suggests...

@fig-stanareyouokay-2 is a Rhat plot. It shows... This suggests...

```{r}

```



\newpage


# References


